<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="post">
	
	<select id="selectPostId" resultType="String" parameterType="map">
		select CONCAT(DATE_FORMAT(SYSDATE(),'%Y%m%d%H%i%s'), COUNT(1) , IFNULL(#{memberId},999) ) FROM DUAL  
	</select>
	
	
	
	<insert id="insertPost"  parameterType="map" >
		
		INSERT INTO POST (
				POST_ID       
				, TITLE         
				, CONTENTS      
				, TAGS          
				, AI_YN         
				, FUN_START_DT  
				, FUN_END_DT    
				, TGT_AMT       
				, OPEN_AMT      
				, ANO_FUN_YN    
				, ADULT_YN      
				, DOMAIN_TYPE   
				, FILE_GROUP_ID 
				, USE_YN        
				, REGIST_DT     
				, REGIST_ID     
				, REGIST_IP     
				, UPDATE_DT     
				, UPDATE_ID     
				, UPDATE_IP     
				)
		VALUES(
			#{postId}
			,#{title}
			,#{contents}
			,#{tags}
			,#{aiYn}
			,#{funStartDt}
			,#{funEndDt}
			,#{tgtAmt}
			,#{openAmt}
			,#{anoFunYn}
			,#{adultYn}
			,#{domainType}
			,#{fileGroupId}
			,#{useYn}
			,SYSDATE()
			,#{memberId}
			,'0.0.0.0'
			,SYSDATE()
			,#{memberId}
			,'0.0.0.0'
		)
	
	
	</insert>
	
	
	<!-- 포스트 목록을 조회한다. -->
	<select id="selectPostList" resultType="map" parameterType="map">
		SELECT A.POST_ID
		     , A.TITLE
		     , A.CONTENTS
		     , LEFT( A.CONTENTS ,100 ) AS CONTENTS2
		     , A.TAGS
		     , A.AI_YN
		     , A.FUN_START_DT
		     , A.FUN_END_DT
		     , A.TGT_AMT
		     , A.OPEN_AMT
		     , A.ANO_FUN_YN
		     , A.DOMAIN_TYPE
		     , A.REGIST_ID
		     , B.THUMBNAIL_NM
		     , C.NAME
		/* SELECT **/
		FROM POST A
		LEFT JOIN UPLOAD_FILE B
		  ON B.POST_ID = A.POST_ID
		 AND B.GROUP_ID = '001' /*001 썸네일 이미지.*/
		JOIN MEMBER C
		  ON C.MEMBER_ID = A.REGIST_ID
		WHERE 1=1
		 <if test='type != null'>

 		</if>
 		 <if test='regMemberId != null'>
			
 		</if>
		ORDER BY rand()
		LIMIT 10
		
		
		   
	</select>
	
	
		<!-- 포스트 목록을 조회한다. -->
	<select id="selectPost" resultType="map" parameterType="map">
		SELECT A.POST_ID
		     , A.TITLE
		     , A.CONTENTS
		     , LEFT( A.CONTENTS ,100 ) AS CONTENTS2
		     , A.TAGS
		     , A.AI_YN
		     , A.FUN_START_DT
		     , A.FUN_END_DT
		     , A.TGT_AMT
		     , A.OPEN_AMT
		     , A.ANO_FUN_YN
		     , A.DOMAIN_TYPE
		     , A.REGIST_ID
		     , B.THUMBNAIL_NM
		     , B.FILE_ID
		     , C.NAME
		/* SELECT **/
		FROM POST A
		LEFT JOIN UPLOAD_FILE B
		  ON B.POST_ID = A.POST_ID
		 AND B.GROUP_ID = '001' /*001 썸네일 이미지.*/
		JOIN MEMBER C
		  ON C.MEMBER_ID = A.REGIST_ID
		WHERE 1=1
		 <if test='postId != null'>
		  AND A.POST_ID = #{postId}
 		</if>
 		 <if test='regMemberId != null'>

 		</if>
		
		   
	</select>
	
	
	<!-- 포스트 첨부파일을 조회한다. -->
	<select id="selectPostFileList" resultType="map" parameterType="map">
		SELECT FILE_ID
		     , FILE_NM
		     , THUMBNAIL_NM
		FROM UPLOAD_FILE
		WHERE 1=1
		 AND POST_ID = #{postId}
		 AND USE_YN = 'Y'
		 AND GROUP_ID = #{groupId}
		
		
		   
	</select>

</mapper>